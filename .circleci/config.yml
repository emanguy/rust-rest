version: 2.1

orbs:
  rust: circleci/rust@1.6

jobs:
  build-and-test:
    docker:
      - image: ghcr.io/emanguy/rust-ci:1.0.0
    steps:
      - checkout
      - rust/build
      - run: 
          name: "Run tests"
          command: cargo nextest run --profile=ci
      - store_test_results:
          path: target/nextest/ci
  validate-quality:
    docker:
      - image: rust:1.61
    steps:
      - checkout
      - rust/clippy
      - rust/format

workflows:
  standard:
    jobs:
      - build-and-test
      - validate-quality
